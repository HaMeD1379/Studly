version: "3.9"
services:
  backend:
    image: ${REGISTRY:-docker.io}/${NAMESPACE}/studly-backend:${IMAGE_TAG:-latest}
    build:
      context: ../../
      dockerfile: infra/docker/backend.mem.Dockerfile
    container_name: studly_backend
    environment:
      PORT: 3000
      INTERNAL_API_TOKEN: studly-local-token
    ports:
      - "3000:3000"
    expose:
      - "3000"
  frontend:
    image: ${REGISTRY:-docker.io}/${NAMESPACE}/studly-frontend:${IMAGE_TAG:-latest}
    build:
      context: ../../apps/frontend
      args:
        VITE_API_BASE_URL: http://localhost:3000/api
        VITE_RAILWAY_API_TOKEN: studly-local-token
    container_name: studly_frontend
    depends_on:
      - backend
    ports:
      - "5173:80"
    expose:
      - "80"
networks:
  default:
    name: studly_net

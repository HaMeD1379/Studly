version: "3.9"
services:
  # Self-contained backend (mock mode)
  backend:
    image: ${REGISTRY:-docker.io}/${NAMESPACE}/studly-backend:${IMAGE_TAG:-latest}
    environment:
      NODE_ENV: production
      PORT: 3000
      # Accept the token baked into the frontend image built by CD
      INTERNAL_API_TOKEN: studly-local-token
      # Ensure in-memory mock mode (no external DB required)
      STUDLY_USE_MOCK: "1"
    ports:
      - "3000:3000"

  # Nginx-served frontend
  frontend:
    image: ${REGISTRY:-docker.io}/${NAMESPACE}/studly-frontend:${IMAGE_TAG:-latest}
    depends_on:
      - backend
    ports:
      - "8080:80"

networks:
  default:
    name: studly_net
